{% extends 'layout.html' %}

{% block newBooking %}
active
{% endblock %}

{% block head %}

<title>Summary</title>
<script src="../../static/bookingSummary.js"></script>
<script src="../../static/userForms.js"></script>

<!-- Passing data to JS -->
<script>
let ticketSum = {{ ticketSum }};
let priceSum = {{ priceSum }};
</script>

{% endblock %}

{% block body %}

    <div id="confirmationScreen" class="fixed hidden opacity-0 top-0 z-50 bg-base-100/0 w-screen h-lvh transition-all duration-500 ease-in-out">
        <div class="flex flex-col items-center justify-center w-full h-full">
            <h2 class="text-3xl sm:text-6xl text-center text-content font-bold">Booking Confirmed.</h2>
        </div>
    </div>



    <!-- Content Container -->
    <div class="mx-4 mb-3 w-content flex flex-col gap-3 items-center">
        <div class="text-sm breadcrumbs py-0">
        <ul>
            <li><a href="/booking/new">Viewings</a></li>
            <li><a href="/booking/tickets">Ticket Selection</a></li>
            <li><a href="/booking/seats">Seat Selection</a></li>
            <li class="font-semibold">Summary</li>
        </ul>

        </div>

        <h1 class="text-3xl sm:text-6xl my-6 text-center text-bg-base-200 align-middle font-bold">{{ viewing.Name }} - Summary</h1>

        <!-- Interaction box container -->
        <div class="flex flex-col w-full sm:w-5/6 lg:w-7/12 ">
            <!-- Main interaction card -->
            <div class="card bg-base-300 min-h-96 w-full">
                {% if viewing.Banner %}
                    <figure class="h-24"><img class="w-full" src="{{ viewing.Banner }}" alt="{{viewing.name}} banner" /></figure>
                {% else %}
                    <figure></figure>
                {% endif %}
                <div class="card-body gap-8 p-3 sm:p-10">
                <div class="flex gap-4 flex-col sm:p-0 p-3">
                    <h2 class="card-title text-2xl sm:text-4xl font-bold">{{ viewing.Name }}</h2>
                  <span class='flex flex-wrap gap-3 w-full'>
                 <div class="badge p-3 flex gap-2 badge-neutral font-semibold"><svg class="w-4 self-center" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <style type="text/css"> .st0{fill:#ffffffec;} </style> <g> <path class="st0" d="M149.193,103.525c15.995,0,28.964-12.97,28.964-28.973V28.964C178.157,12.97,165.188,0,149.193,0 c-16.002,0-28.973,12.97-28.973,28.964v45.588C120.22,90.556,133.191,103.525,149.193,103.525z"></path> <path class="st0" d="M362.816,103.525c15.994,0,28.964-12.97,28.964-28.973V28.964C391.78,12.97,378.81,0,362.816,0 c-16.003,0-28.973,12.97-28.973,28.964v45.588C333.843,90.556,346.813,103.525,362.816,103.525z"></path> <path class="st0" d="M435.164,41.287h-17.925v33.265c0,30.017-24.414,54.432-54.422,54.432c-30.018,0-54.432-24.415-54.432-54.432 V41.287H203.616v33.265c0,30.017-24.415,54.432-54.423,54.432c-30.016,0-54.432-24.415-54.432-54.432V41.287H76.836 c-38.528,0-69.763,31.235-69.763,69.763v331.187C7.073,480.765,38.309,512,76.836,512h358.328 c38.528,0,69.763-31.235,69.763-69.763V111.05C504.927,72.522,473.692,41.287,435.164,41.287z M470.982,442.237 c0,19.748-16.069,35.818-35.818,35.818H76.836c-19.748,0-35.818-16.07-35.818-35.818V155.138h429.964V442.237z"></path> <rect x="175.862" y="384.002" class="st0" width="62.859" height="62.859"></rect> <rect x="175.862" y="286.584" class="st0" width="62.859" height="62.859"></rect> <rect x="78.453" y="384.002" class="st0" width="62.851" height="62.859"></rect> <rect x="78.453" y="286.584" class="st0" width="62.851" height="62.859"></rect> <rect x="370.697" y="189.175" class="st0" width="62.851" height="62.851"></rect> <rect x="273.28" y="189.175" class="st0" width="62.859" height="62.851"></rect> <rect x="273.28" y="286.584" class="st0" width="62.859" height="62.859"></rect> <rect x="370.697" y="384.002" class="st0" width="62.851" height="62.859"></rect> <rect x="370.697" y="286.584" class="st0" width="62.851" height="62.859"></rect> <rect x="273.28" y="384.002" class="st0" width="62.859" height="62.859"></rect> <rect x="175.862" y="189.175" class="st0" width="62.859" height="62.851"></rect> <rect x="78.453" y="189.175" class="st0" width="62.851" height="62.851"></rect> </g> </g></svg> {{ viewing.dateFormatted}}</div>
                <div class="badge p-3 flex gap-2 badge-neutral font-semibold"><svg class="w-4 self-center" height="200px" width="200px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <style type="text/css"> .st0{fill:#ffffffec;} </style> <g> <path class="st0" d="M94.568,165.976l-0.448,0.863l15.71,7.895l15.826,9.274l0.548-0.968c0.948-1.694,1.924-3.355,2.928-4.992 l-30.619-18.806C97.153,161.444,95.841,163.694,94.568,165.976z"></path> <path class="st0" d="M110.667,255.847c0-1.339,0.026-2.686,0.059-4.024l-43.109-0.855c-0.052,1.629-0.076,3.258-0.076,4.879 l0.024,3.097l43.129-0.54L110.667,255.847z"></path> <path class="st0" d="M93.391,343.936c1.276,2.363,2.611,4.702,4,7.024l30.828-18.468c-1.109-1.855-2.175-3.734-3.2-5.637 L93.391,343.936z"></path> <path class="st0" d="M386.883,184.976l31.586-17.154c-1.284-2.355-2.611-4.685-3.988-6.992l-30.829,18.476 C384.776,181.178,385.851,183.064,386.883,184.976z"></path> <path class="st0" d="M256.147,110.669c1.292,0,2.583,0.016,3.869,0.057l0.926-43.113c-1.593-0.048-3.194-0.072-4.794-0.072 l-3.264,0.032l0.645,43.121L256.147,110.669z"></path> <path class="st0" d="M185.056,125.072l-17.101-31.605c-2.365,1.274-4.702,2.605-7.012,3.984l18.462,30.839 C181.266,127.178,183.153,126.105,185.056,125.072z"></path> <path class="st0" d="M352.641,98.444c-2.161-1.323-4.365-2.613-6.71-3.92l-8.964,15.573l-8.423,15.879 c1.804,1,3.572,2.04,5.314,3.105L352.641,98.444z"></path> <path class="st0" d="M326.754,387.032l17.044,31.645c2.371-1.274,4.716-2.605,7.026-3.984l-18.419-30.863 C330.544,384.944,328.663,386.008,326.754,387.032z"></path> <path class="st0" d="M382.762,334.121l30.562,18.903c1.418-2.29,2.78-4.613,3.91-6.653l0.568-1.008l-31.77-16.814 C384.98,330.436,383.885,332.298,382.762,334.121z"></path> <path class="st0" d="M159.133,413.419c2.232,1.379,4.506,2.71,6.915,4.057l17.413-31.444c-1.867-1.04-3.706-2.121-5.516-3.226 L159.133,413.419z"></path> <path class="st0" d="M444.417,252.718l-43.111,0.742l0.026,2.702c0,1.25-0.026,2.5-0.059,3.758l43.109,0.895 c0.052-1.556,0.076-3.105,0.076-4.653L444.417,252.718z"></path> <path class="st0" d="M255.853,401.339c-1.361,0-2.724-0.024-4.093-0.065l-0.982,43.105c1.691,0.064,3.389,0.088,5.074,0.088 l2.97-0.024l-0.562-43.129L255.853,401.339z"></path> <path class="st0" d="M256,0C114.839,0,0,114.847,0,256c0,141.161,114.839,256,256,256s256-114.839,256-256 C512,114.847,397.161,0,256,0z M256,465.597c-115.572,0-209.597-94.024-209.597-209.597S140.428,46.403,256,46.403 S465.605,140.428,465.605,256S371.572,465.597,256,465.597z"></path> <path class="st0" d="M385.351,154.282l-20.03-21.081L258.976,234.226l-66.774-66.774l-27.359,27.363l66.07,66.073l-22.609,21.476 l20.032,21.089l23.147-21.992l24.056,24.056l27.361-27.363l-23.355-23.355L385.351,154.282z M256,269.081 c-7.222,0-13.077-5.855-13.077-13.081c0-7.218,5.855-13.072,13.077-13.072c7.222,0,13.074,5.855,13.074,13.072 C269.074,263.226,263.222,269.081,256,269.081z"></path> </g> </g></svg> {{viewing.Time}}</div>
                <div class="tooltip" data-tip="Remaining tickets">
                <div class="badge p-3 flex gap-2 badge-neutral font-semibold"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-5.25h5.25M7.5 15h3M3.375 5.25c-.621 0-1.125.504-1.125 1.125v3.026a2.999 2.999 0 0 1 0 5.198v3.026c0 .621.504 1.125 1.125 1.125h17.25c.621 0 1.125-.504 1.125-1.125v-3.026a2.999 2.999 0 0 1 0-5.198V6.375c0-.621-.504-1.125-1.125-1.125H3.375Z" /></svg>{{viewing.remainingSeatCount}}</div>
                </div>
                </span>
                </div>

                <div class="divider sm:visible invisible"></div>

                    <div class="flex flex-col gap-4">
                    {% for ticket in tickets %}
                        <div class="flex bg-base-200 rounded-box p-4 items-center">
                            <p class="text-lg sm:text-2xl font-bold">{{ ticketTypes[ticket.ticketType-1].Name }}</p>
                            <p class="text-lg sm:text-2xl font-semibold text-slate-400 grow-0 px-5">{{ "£%.2f"|format(ticketTypes[ticket.ticketType-1].Price) }}</p>
                        </div>
                    {% endfor %}
                    </div>

                    <div class="flex flex-col items-end w-full p-4 py-0">
                    <p class="text-lg sm:text-xl font-semibold text-primary grow-0">Total</p>
                    <p class="text-lg sm:text-4xl font-semibold grow-0" id="priceSumIndicator">{{ "£%.2f"|format(priceSum) }}</p>
                    </div>

                    <div class="divider my-0"></div>

                    <!-- User selection -->
                    <div class="flex flex-col w-full sm:flex-row ">

                        <!-- Select existing user -->
                        <div class="drawer drawer-end">
                        <input id="existingUserDraw" type="checkbox" class="drawer-toggle" />
                        <div class="drawer-content">
                            <label for="existingUserDraw" onclick="getAllCustomers('existingUserTable')"
                                   class="drawer-button btn flex-grow h-16 card bg-secondary hover:bg-slate-600
                                   transition-all duration-200 ease-in-out text-base-100 rounded-box">
                                Select a user
                            </label>
                        </div>
                        <div class="drawer-side z-50">
                            <label for="existingUserDraw" aria-label="close sidebar" class="drawer-overlay"></label>

                            <!-- Table of existing users / Draw Content -->
                            <div class="overflow-x-auto flex flex-col gap-3  p-4 w-10/12 sm:w-1/2 min-h-full bg-base-300 text-base-content">
                                <div class="bg-base-300 drop-shadow-md w-full top-16 z-50 rounded-box p-3 gap-5 flex justify-between">
                                    <div></div>
                                    <label class="input flex items-center gap-2 w-full rounded-box max-w-xs">
                                        <input type="text" onkeyup="getCustomersByName('customerSearchBar', 'existingUserTable')" id="customerSearchBar" placeholder="Search users" class="grow w-full" />
                                    </label>
                                </div>

                              <div class="border-base-200">
                              <table class="table table-sm w-full" id="existingUserTable">
                                <thead>
                                  <tr class="bg-secondary text-base-100">
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone Number</th>
                                  </tr>
                                </thead>
                                <tbody>

                                </tbody>
                              </table>
                            </div>
                                <!-- End Draw Content -->
                        </div>
                        </div>
                        </div>
                        <!-- End select existing user -->

                        <div class="divider sm:divider-horizontal">OR</div>

                        <!-- Add new user -->
                        <div class="drawer drawer-end">
                        <input id="newUserDraw" type="checkbox" class="drawer-toggle" />
                        <div class="drawer-content">
                            <label for="newUserDraw" class="drawer-button btn flex-grow h-16 card bg-secondary hover:bg-slate-600 transition-all duration-200 ease-in-out text-base-100 rounded-box">Add a new user</label>
                        </div>
                        <div class="drawer-side z-50">
                            <label for="newUserDraw" aria-label="close sidebar" class="drawer-overlay"></label>

                            <form id="newUserForm" class="menu p-6 w-10/12 sm:w-1/4 min-h-full bg-base-200 text-base-content gap-3">
                                <input type="text" name="name" id="newName" placeholder="Name" class="input input-primary rounded-md input-bordered" required>
                                <input type="text" name="email" id="newEmail" placeholder="Email" class="input input-primary rounded-md input-bordered" required>
                                <input type="text" name="phone" id="newPhone" placeholder="Phone" class="input input-primary rounded-md input-bordered" required>
                                <button class="btn btn-primary items-center btn-block sm:btn-md mw-8 sm:mw-0 sm:w-auto flex-end rounded-md text-base-200 transition-all ease-in-out duration-200">Add User</button>
                            </form>
                            </div>
                        </div>
                        <!-- End add new user -->

                    </div>
                    <div class="card card-outline bg-base-200 p-4 w-full">
    {#                        <p class="text-lg sm:text-xl font-semibold text-primary">Selected User</p>#}

                            <table class="table table-lg w-full" id="selectedUserTable">
                                <tbody>
                                    <tr>
                                        <td class="font-semibold">Name</td>
                                        <td id="selectedName">None</td>
                                    </tr>
                                    <tr>
                                        <td class="font-semibold">Email</td>
                                        <td id="selectedEmail">None</td>
                                    </tr>
                                    <tr>
                                        <td class="font-semibold">Phone Number</td>
                                        <td id="selectedPhone">None</td>
                                    </tr>

                                </tbody>
                            </table>
                        </div>
                </div>

                <p class="text-center text-sm mb-6 text-neutral">A receipt will be sent to the customer's email address.</p>
            </div>

            <div class="flex flex-col gap-4 sm:gap-0 my-3 px-0 p-3 sm:flex-row w-full items-center justify-between transition-full ease-in-out duration-100">
                <div></div> <!-- Spacer -->

                <div class="tooltip order-2 sm:tooltip-left tooltip-bottom tooltip-open" id="continueTooltip" data-tip="Select a user to submit">
                    <button class="btn btn-primary items-center btn-block sm:btn-md mw-8 sm:mw-0 sm:w-auto flex-end rounded-md text-base-200 transition-all ease-in-out duration-200" onclick="submitBooking()" disabled="disabled" id="continueBtn">Submit
                        <!-- prettier-ignore -->
                        <svg class="stroke-base-200 transition-all ease-in-out duration-400" width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M5 12H19M19 12L13 6M19 12L13 18" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- End Content Container -->

{% endblock %}